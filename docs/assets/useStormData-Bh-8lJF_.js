import{r as o}from"./vendor-l9rrfVDV.js";import{e as h,f as S}from"./index-eAN7I8HX.js";import{getCachedData as g,setCachedData as D}from"./cacheService-Di-KdHW3.js";const N=async()=>{try{const e=`${h.NHC_STORM}/7/query?where=1%3D1&outFields=*&f=geojson`,r=await fetch(e,{signal:AbortSignal.timeout(15e3)});if(!r.ok)throw new Error(`NHC API error: ${r.status} ${r.statusText}`);const a=await r.json();return!a.features||a.features.length===0?{storms:[],fetchedAt:new Date().toISOString(),source:"nhc"}:{storms:a.features.map(t=>({id:`${t.properties.BASIN||"UNK"}${t.properties.STORMNUM||"00"}`,name:t.properties.STORMNAME||"Unknown",basin:A(t.properties.BASIN),type:t.properties.STORMTYPE||"Unknown",category:I(t.properties.STORMTYPE,t.properties.MAXWIND),advisoryNumber:t.properties.ADVISNUM,movement:{direction:t.properties.MOVEMENTDIR||null,speed:t.properties.MOVEMENTSPD||null},intensity:{windSpeed:t.properties.MAXWIND||null,pressure:t.properties.MINPRES||null},coordinates:t.geometry.coordinates,geometry:t.geometry})),fetchedAt:new Date().toISOString(),source:"nhc"}}catch(e){return console.error("NHC storm fetch error:",e),{storms:[],fetchedAt:new Date().toISOString(),source:"nhc",error:e.message}}},A=e=>({AL:"atlantic",EP:"epac",CP:"cpac",WP:"wpac",IO:"nio",SH:"aus"})[e]||e,I=(e,r)=>e==="TD"||e==="TS"?0:r?r>=137?5:r>=113?4:r>=96?3:r>=83?2:r>=64?1:0:null,T=(e="all")=>{const[r,a]=o.useState(null),[t,i]=o.useState(!0),[m,l]=o.useState(null),u=`storms_${e}`,n=o.useCallback(async(f=!1)=>{i(!0),l(null);try{if(!f){const c=await g("stormCache",u);if(c){a(c),i(!1);return}}const s=await N();e!=="all"&&s.storms&&(s.storms=s.storms.filter(c=>c.basin===e)),a(s),await D("stormCache",u,s,S.STORM)}catch(s){console.error("Storm data fetch error:",s),l({title:"Storm Data Unavailable",message:s.message||"Unable to fetch storm data. Please try again."})}finally{i(!1)}},[e,u]);o.useEffect(()=>{n()},[n]);const p=o.useCallback(()=>n(!0),[n]);return{data:r,isLoading:t,error:m,refetch:p}};export{T as u};
