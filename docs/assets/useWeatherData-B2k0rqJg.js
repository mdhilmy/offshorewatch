import{r as l}from"./vendor-l9rrfVDV.js";import{e as y,f}from"./index-eAN7I8HX.js";import{getCachedData as g,setCachedData as v}from"./cacheService-Di-KdHW3.js";const S=async(e,n,t=7)=>{const a=new URLSearchParams({latitude:e.toString(),longitude:n.toString(),hourly:"wave_height,wave_direction,wave_period,swell_wave_height,wind_wave_height",daily:"wave_height_max",timezone:"UTC",forecast_days:t.toString()}),r=await fetch(`${y.OPEN_METEO_MARINE}?${a}`,{signal:AbortSignal.timeout(15e3)});if(!r.ok)throw new Error(`Marine API error: ${r.status} ${r.statusText}`);const s=await r.json();return D(s)},E=async(e,n,t=7)=>{const a=new URLSearchParams({latitude:e.toString(),longitude:n.toString(),hourly:"temperature_2m,wind_speed_10m,wind_direction_10m,wind_gusts_10m,visibility,pressure_msl",daily:"temperature_2m_max,temperature_2m_min,wind_speed_10m_max",timezone:"UTC",forecast_days:t.toString()}),r=await fetch(`${y.OPEN_METEO_WEATHER}?${a}`,{signal:AbortSignal.timeout(15e3)});if(!r.ok)throw new Error(`Weather API error: ${r.status} ${r.statusText}`);const s=await r.json();return x(s)},A=async(e,n,t=7)=>{try{const[a,r]=await Promise.all([S(e,n,t),E(e,n,t)]);return{location:{latitude:e,longitude:n},fetchedAt:new Date().toISOString(),source:"open-meteo",hourly:a.hourly.map((s,o)=>({...s,...r.hourly[o]})),daily:{marine:a.daily,atmospheric:r.daily}}}catch(a){throw console.error("Combined weather fetch error:",a),a}},D=e=>({hourly:e.hourly.time.map((n,t)=>{var a,r,s,o,i;return{time:n,waveHeight:((a=e.hourly.wave_height)==null?void 0:a[t])??null,waveDirection:((r=e.hourly.wave_direction)==null?void 0:r[t])??null,wavePeriod:((s=e.hourly.wave_period)==null?void 0:s[t])??null,swellHeight:((o=e.hourly.swell_wave_height)==null?void 0:o[t])??null,windWaveHeight:((i=e.hourly.wind_wave_height)==null?void 0:i[t])??null}}),daily:e.daily.time.map((n,t)=>{var a;return{date:n,waveHeightMax:((a=e.daily.wave_height_max)==null?void 0:a[t])??null}})}),x=e=>({hourly:e.hourly.time.map((n,t)=>{var a,r,s,o,i,u;return{time:n,temperature:((a=e.hourly.temperature_2m)==null?void 0:a[t])??null,windSpeed:((r=e.hourly.wind_speed_10m)==null?void 0:r[t])??null,windDirection:((s=e.hourly.wind_direction_10m)==null?void 0:s[t])??null,windGusts:((o=e.hourly.wind_gusts_10m)==null?void 0:o[t])??null,visibility:((i=e.hourly.visibility)==null?void 0:i[t])??null,pressure:((u=e.hourly.pressure_msl)==null?void 0:u[t])??null}}),daily:e.daily.time.map((n,t)=>{var a,r,s;return{date:n,tempMax:((a=e.daily.temperature_2m_max)==null?void 0:a[t])??null,tempMin:((r=e.daily.temperature_2m_min)==null?void 0:r[t])??null,windSpeedMax:((s=e.daily.wind_speed_10m_max)==null?void 0:s[t])??null}})}),W=(e,n)=>{const[t,a]=l.useState(null),[r,s]=l.useState(!0),[o,i]=l.useState(null),[u,d]=l.useState(null),c=e&&n?`${e},${n}`:null,m=l.useCallback(async(w=!1)=>{if(!e||!n){s(!1);return}s(!0),i(null);try{if(!w&&c){const _=await g("weatherCache",c);if(_){a(_),d(_.fetchedAt),s(!1);return}}const h=await A(e,n);a(h),d(h.fetchedAt),c&&await v("weatherCache",c,h,f.WEATHER)}catch(h){console.error("Weather data fetch error:",h),i({title:"Weather Data Unavailable",message:h.message||"Unable to fetch weather data. Please try again."})}finally{s(!1)}},[e,n,c]);l.useEffect(()=>{m()},[m]);const p=l.useCallback(()=>m(!0),[m]);return{data:t,isLoading:r,error:o,lastFetch:u,refetch:p}};export{W as u};
