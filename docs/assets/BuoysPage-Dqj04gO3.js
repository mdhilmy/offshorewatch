import{j as e,L as W,C as P,a as $,b as T,P as A,c as D,p as E,d as M,e as L,i as R}from"./charts-L6FsWgqu.js";import{r as h}from"./vendor-l9rrfVDV.js";import{c as B,e as k,u as H,W as N,d as F,h as G,L as U}from"./index-eAN7I8HX.js";import{u as O}from"./useUnits-5qtlhRyL.js";import{f as _,a as j}from"./dateUtils-C0Z1jtkc.js";import{C as f}from"./Card-mKvuYzky.js";import{E as X}from"./ErrorMessage-DGsvJo_K.js";import{W as C,T as I}from"./wind-B7X9ZIZY.js";import"./alert-circle-CraVoUg3.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=B("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),Z="https://corsproxy.io/?",Y=async s=>{const a=`${k.NDBC_BUOY}/${s}.txt`;let r;try{const i=await fetch(a,{signal:AbortSignal.timeout(1e4)});if(!i.ok)throw new Error(`NDBC error: ${i.status}`);r=await i.text()}catch{try{const i=await fetch(`${Z}${encodeURIComponent(a)}`,{signal:AbortSignal.timeout(1e4)});if(!i.ok)throw new Error(`Proxy error: ${i.status}`);r=await i.text()}catch{throw new Error(`Unable to fetch buoy ${s} data. NDBC may be temporarily unavailable.`)}}return K(s,r)},K=(s,a)=>{const r=a.trim().split(`
`);if(r.length<3)throw new Error(`No data available for buoy ${s}`);r[0].replace("#","").trim().split(/\s+/);const i=[];for(let l=2;l<Math.min(r.length,50);l++){const t=r[l].trim().split(/\s+/);if(t.length<10)continue;const d=t[0],m=t[1],o=t[2],x=t[3],u=t[4],n={time:`${d}-${m}-${o}T${x}:${u}:00Z`,windDirection:c(t[5]),windSpeed:c(t[6]),windGusts:c(t[7]),waveHeight:c(t[8]),dominantPeriod:c(t[9]),averagePeriod:c(t[10]),meanWaveDir:c(t[11]),pressure:c(t[12]),airTemp:c(t[13]),waterTemp:c(t[14]),dewpoint:c(t[15]),visibility:c(t[16])};i.push(n)}return{stationId:s,fetchedAt:new Date().toISOString(),source:"ndbc",observations:i,latest:i[0]||null}},c=s=>{if(!s||s==="MM"||s==="99.0"||s==="99.00"||s==="999"||s==="999.0"||s==="9999.0")return null;const a=parseFloat(s);return isNaN(a)?null:a},V=s=>{const a={gom:[{id:"42001",name:"Mid Gulf - 250 NM SSW of Southwest Pass, LA",lat:25.888,lon:-89.658},{id:"42002",name:"West Gulf - 207 NM ESE of Brownsville, TX",lat:25.79,lon:-93.666},{id:"42003",name:"East Gulf - 265 NM S of Panama City, FL",lat:25.925,lon:-85.612},{id:"42019",name:"Freeport, TX - 60 NM S",lat:27.913,lon:-95.352},{id:"42020",name:"Corpus Christi, TX - 50 NM SE",lat:26.966,lon:-96.694},{id:"42035",name:"Galveston, TX - 22 NM E",lat:29.232,lon:-94.413},{id:"42036",name:"West Tampa, FL - 112 NM WNW",lat:28.5,lon:-84.517},{id:"42039",name:"Pensacola, FL - 115 NM SSE",lat:28.791,lon:-86.008},{id:"42040",name:"Luke Island, LA",lat:29.185,lon:-88.226}],northsea:[{id:"62105",name:"K13 Platform (Netherlands)",lat:53.22,lon:3.22}]};return a[s]||a.gom},q=s=>{const[a,r]=h.useState(null),[i,l]=h.useState(!1),[t,d]=h.useState(null),m=h.useCallback(async()=>{if(!s){l(!1);return}l(!0),d(null);try{const o=await Y(s);r(o)}catch(o){console.error("Buoy data fetch error:",o),d({title:"Buoy Data Unavailable",message:o.message||`Unable to fetch data for station ${s}.`})}finally{l(!1)}},[s]);return h.useEffect(()=>{m()},[m]),{data:a,isLoading:i,error:t,refetch:m}};P.register($,T,A,D,E,M,L,R);const ce=()=>{var S;const{state:s}=H(),{formatWave:a,formatWindMs:r,formatTemp:i,formatPressure:l,getWaveUnit:t,getWindUnit:d,getTempUnit:m}=O(),o=h.useMemo(()=>V(s.currentRegion),[s.currentRegion]),[x,u]=h.useState(((S=o[0])==null?void 0:S.id)||"42001"),{data:n,isLoading:b,error:v,refetch:w}=q(x),y=o.find(p=>p.id===x);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-8 h-8 text-primary-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Buoy Data"}),e.jsx("p",{className:"text-gray-600",children:"Real-time observations from NOAA NDBC buoy stations"})]})]}),e.jsx("button",{onClick:w,disabled:b,className:"p-2 rounded-md hover:bg-gray-100 text-gray-600 disabled:opacity-50",children:e.jsx(F,{className:`w-5 h-5 ${b?"animate-spin":""}`})})]}),e.jsx(f,{title:"Select Buoy Station",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("select",{value:x,onChange:p=>u(p.target.value),className:"input-field max-w-lg",children:o.map(p=>e.jsxs("option",{value:p.id,children:[p.id," — ",p.name]},p.id))}),y&&e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),y.lat.toFixed(3),"°N, ",Math.abs(y.lon).toFixed(3),"°",y.lon<0?"W":"E"]})]})}),b?e.jsx(U,{message:`Fetching data for station ${x}...`}):v?e.jsx(X,{error:v,onRetry:w}):n!=null&&n.latest?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsx(g,{icon:e.jsx(N,{className:"w-4 h-4 text-blue-500"}),label:"Wave Height",formatted:a(n.latest.waveHeight)}),e.jsx(g,{icon:e.jsx(N,{className:"w-4 h-4 text-purple-500"}),label:"Dom. Period",formatted:n.latest.dominantPeriod!=null?`${n.latest.dominantPeriod.toFixed(0)} s`:"N/A"}),e.jsx(g,{icon:e.jsx(C,{className:"w-4 h-4 text-green-500"}),label:"Wind Speed",formatted:r(n.latest.windSpeed)}),e.jsx(g,{icon:e.jsx(C,{className:"w-4 h-4 text-amber-500"}),label:"Wind Gusts",formatted:r(n.latest.windGusts)}),e.jsx(g,{icon:e.jsx(I,{className:"w-4 h-4 text-red-500"}),label:"Air Temp",formatted:i(n.latest.airTemp)}),e.jsx(g,{icon:e.jsx(z,{className:"w-4 h-4 text-gray-500"}),label:"Pressure",formatted:l(n.latest.pressure)})]}),e.jsx(f,{title:"Recent Wave Height",subtitle:`Last ${n.observations.length} observations`,children:e.jsx(J,{observations:n.observations,waveUnit:t()})}),e.jsx(f,{title:"Recent Wind Speed",subtitle:"Wind speed and gusts",children:e.jsx(Q,{observations:n.observations,windUnit:d()})}),e.jsx(f,{title:"Observation History",subtitle:`Station ${n.stationId}`,children:e.jsx(ee,{observations:n.observations,formatWave:a,formatWindMs:r,formatTemp:i,formatPressure:l,waveUnit:t(),windUnit:d(),tempUnit:m()})}),e.jsxs("p",{className:"text-xs text-gray-400 text-right",children:["Source: NOAA NDBC | Station ",n.stationId," | Updated: ",n.fetchedAt?_(n.fetchedAt):"N/A"]})]}):e.jsx(f,{children:e.jsx("p",{className:"text-gray-500",children:"No buoy data available. Select a station and try again."})})]})},g=({icon:s,label:a,formatted:r})=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[s,e.jsx("p",{className:"text-xs text-gray-500",children:a})]}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:r})]}),J=({observations:s,waveUnit:a="m"})=>{const r=[...s].reverse(),i={labels:r.map(t=>j(t.time,"HH:mm")),datasets:[{label:`Wave Height (${a})`,data:r.map(t=>t.waveHeight),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.3,pointRadius:2}]},l={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:t=>{var d;return`${((d=t.parsed.y)==null?void 0:d.toFixed(1))??"N/A"} ${a}`}}}},scales:{x:{ticks:{maxTicksLimit:10,font:{size:10}},grid:{display:!1}},y:{beginAtZero:!0,title:{display:!0,text:a},grid:{color:"rgba(0,0,0,0.06)"}}}};return e.jsx("div",{className:"h-[250px]",children:e.jsx(W,{data:i,options:l})})},Q=({observations:s,windUnit:a="m/s"})=>{const r=[...s].reverse(),i={labels:r.map(t=>j(t.time,"HH:mm")),datasets:[{label:`Wind Speed (${a})`,data:r.map(t=>t.windSpeed),borderColor:"#10b981",tension:.3,pointRadius:2},{label:`Gusts (${a})`,data:r.map(t=>t.windGusts),borderColor:"#f59e0b",borderDash:[4,4],tension:.3,pointRadius:0}]},l={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:12}}},scales:{x:{ticks:{maxTicksLimit:10,font:{size:10}},grid:{display:!1}},y:{beginAtZero:!0,title:{display:!0,text:a},grid:{color:"rgba(0,0,0,0.06)"}}}};return e.jsx("div",{className:"h-[250px]",children:e.jsx(W,{data:i,options:l})})},ee=({observations:s,formatWave:a,formatWindMs:r,formatTemp:i,formatPressure:l,waveUnit:t,windUnit:d,tempUnit:m})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-2 font-medium text-gray-600",children:"Time (UTC)"}),e.jsxs("th",{className:"text-right py-2 px-2 font-medium text-gray-600",children:["Wave (",t,")"]}),e.jsx("th",{className:"text-right py-2 px-2 font-medium text-gray-600",children:"Period (s)"}),e.jsxs("th",{className:"text-right py-2 px-2 font-medium text-gray-600",children:["Wind (",d,")"]}),e.jsxs("th",{className:"text-right py-2 px-2 font-medium text-gray-600",children:["Gusts (",d,")"]}),e.jsxs("th",{className:"text-right py-2 px-2 font-medium text-gray-600",children:["Air (",m,")"]}),e.jsxs("th",{className:"text-right py-2 px-2 font-medium text-gray-600",children:["Water (",m,")"]}),e.jsx("th",{className:"text-right py-2 px-2 font-medium text-gray-600",children:"Press (hPa)"})]})}),e.jsx("tbody",{children:s.slice(0,24).map((o,x)=>{var u,n;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-1.5 px-2 text-gray-700 whitespace-nowrap text-xs",children:j(o.time,"MMM d, HH:mm")}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-xs",children:a(o.waveHeight).split(" ")[0]??"—"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-xs",children:((u=o.dominantPeriod)==null?void 0:u.toFixed(0))??"—"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-xs",children:r(o.windSpeed).split(" ")[0]??"—"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-xs",children:r(o.windGusts).split(" ")[0]??"—"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-xs",children:i(o.airTemp).split(" ")[0]??"—"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-xs",children:i(o.waterTemp).split(" ")[0]??"—"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-xs",children:((n=o.pressure)==null?void 0:n.toFixed(0))??"—"})]},x)})})]})});export{ce as default};
