import{r as i}from"./vendor-l9rrfVDV.js";import{e as w,f as I}from"./index-CsV4c2pm.js";import{getCachedData as f,setCachedData as E}from"./cacheService-CRyDOt_3.js";const C=async(l={})=>{const{minMagnitude:d=4,days:c=7,latitude:u,longitude:s,radiusKm:g=500,limit:p=100}=l,a=new Date;a.setDate(a.getDate()-c);const e=new URLSearchParams({format:"geojson",starttime:a.toISOString().split("T")[0],minmagnitude:d.toString(),orderby:"time",limit:p.toString()});u&&s&&(e.append("latitude",u.toString()),e.append("longitude",s.toString()),e.append("maxradiuskm",g.toString()));const r=await fetch(`${w.USGS_EARTHQUAKE}?${e}`,{signal:AbortSignal.timeout(15e3)});if(!r.ok)throw new Error(`USGS API error: ${r.status} ${r.statusText}`);const o=await r.json();return{fetchedAt:new Date().toISOString(),source:"usgs",count:o.metadata.count,earthquakes:o.features.map(t=>({id:t.id,magnitude:t.properties.mag,place:t.properties.place,time:new Date(t.properties.time).toISOString(),updated:new Date(t.properties.updated).toISOString(),location:{latitude:t.geometry.coordinates[1],longitude:t.geometry.coordinates[0],depth:t.geometry.coordinates[2]},tsunami:t.properties.tsunami===1,type:t.properties.type,status:t.properties.status,url:t.properties.url,felt:t.properties.felt,cdi:t.properties.cdi,mmi:t.properties.mmi,alert:t.properties.alert,sig:t.properties.sig}))}},U=(l={})=>{const[d,c]=i.useState(null),[u,s]=i.useState(!0),[g,p]=i.useState(null),{latitude:a,longitude:e,radiusKm:r=500,minMagnitude:o=4,days:t=7}=l,S=a&&e?`seismic_${a}_${e}_${r}`:"seismic_global",m=i.useCallback(async(y=!1)=>{s(!0),p(null);try{if(!y){const h=await f("seismicCache",S);if(h){c(h),s(!1);return}}const n=await C({latitude:a,longitude:e,radiusKm:r,minMagnitude:o,days:t});c(n),await E("seismicCache",S,n,I.SEISMIC)}catch(n){console.error("Seismic data fetch error:",n),p({title:"Seismic Data Unavailable",message:n.message||"Unable to fetch earthquake data. Please try again."})}finally{s(!1)}},[a,e,r,o,t,S]);i.useEffect(()=>{m()},[m]);const D=i.useCallback(()=>m(!0),[m]);return{data:d,isLoading:u,error:g,refetch:D}};export{U as u};
